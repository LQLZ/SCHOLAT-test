var CANVAS_WIDTH=308;var CANVAS_HEIGHT=288;var ICON_WIDTH_SIZE=160;var ICON_HEIGHT_SIZE=160;var LEFT_EDGE=(CANVAS_WIDTH-ICON_WIDTH_SIZE)/2;var TOP_EDGE=(CANVAS_HEIGHT-ICON_HEIGHT_SIZE)/2;var CANVAS_LEFT_MARGIN=8;var BEGIN_WIDTH=200;var BEGIN_HEIGHT=200;$(window).load(initData,function(p){if(typeof(initData)!="undefined"){if(typeof(p.data.canvasWidth)!="undefined"&&typeof(p.data.canvasHeight)!="undefined"){CANVAS_WIDTH=p.data.canvasWidth;CANVAS_HEIGHT=p.data.canvasHeight;$("#Canvas").css({width:CANVAS_WIDTH+"px",height:CANVAS_HEIGHT+"px"})}ICON_WIDTH_SIZE=p.data.width;ICON_HEIGHT_SIZE=p.data.height;LEFT_EDGE=(CANVAS_WIDTH-ICON_WIDTH_SIZE)/2;TOP_EDGE=(CANVAS_HEIGHT-ICON_HEIGHT_SIZE)/2;$("#avatar_width").val(p.data.width);$("#avatar_height").val(p.data.height);$("#IconContainer").css({top:(0-ICON_HEIGHT_SIZE)+"px"});$("#ImageDragContainer").css({width:ICON_WIDTH_SIZE+"px",height:ICON_HEIGHT_SIZE+"px",top:((CANVAS_HEIGHT-ICON_HEIGHT_SIZE)/2+2)+"px",left:((CANVAS_WIDTH-ICON_WIDTH_SIZE)/2-2)+"px"})}var d=$("#ImageIcon");var j=$("#ImageDrag");var k=new Image();k.src=d.attr("src");var l=k.width;var o=k.height;k=null;var e=Math.min(ICON_WIDTH_SIZE,ICON_HEIGHT_SIZE)/Math.min(l,o)*1.02;if(ICON_WIDTH_SIZE>l&&ICON_HEIGHT_SIZE>o){e=1}var i=e>0.25?8:4/Math.sqrt(e);var a=1;if(o<l){a=Math.min(ICON_WIDTH_SIZE,ICON_HEIGHT_SIZE)/o*1.5}else{a=Math.min(ICON_WIDTH_SIZE,ICON_HEIGHT_SIZE)/l*1.5}$(".child").css("left",100*(Math.log(a*i)/Math.log(i))+"px");var g=Math.round(a*l);var b=Math.round(a*o);var m=Math.round((CANVAS_WIDTH-g)/2);var n=Math.round((CANVAS_HEIGHT-b)/2);var c=m-LEFT_EDGE;var q=n-TOP_EDGE;d.css({width:g+"px",height:b+"px",left:m+"px",top:n+"px"});j.css({width:g+"px",height:b+"px",left:c+"px",top:q+"px"});$("#txt_width").val(g);$("#txt_height").val(b);$("#txt_top").val(0-q);$("#txt_left").val(0-c);$("#txt_Zoom").val(a);var h=g;var f=b;BEGIN_WIDTH=g;BEGIN_HEIGHT=b;j.draggable({cursor:"move",drag:function(w,s){var t=$("#ImageIcon");var v=t.css("top").replace(/px/,"");var u=t.css("left").replace(/px/,"");t.css({left:(parseInt(s.position.left)+LEFT_EDGE)+"px",top:(parseInt(s.position.top)+TOP_EDGE)+"px"});$("#txt_left").val(0-parseInt(s.position.left));$("#txt_top").val(0-parseInt(s.position.top))}});d.draggable({cursor:"move",drag:function(w,s){var t=$("#ImageDrag");var v=t.css("top").replace(/px/,"");var u=t.css("left").replace(/px/,"");t.css({left:(parseInt(s.position.left)-LEFT_EDGE)+"px",top:(parseInt(s.position.top)-TOP_EDGE)+"px"});$("#txt_left").val(0-(parseInt(s.position.left)-LEFT_EDGE));$("#txt_top").val(0-(parseInt(s.position.top)-TOP_EDGE))}});$(".child").draggable({cursor:"move",containment:$("#bar"),drag:function(y,A){var u=parseInt($(this).css("left"));a=Math.pow(i,(u/100-1));if(a<e){a=e}if(a>i){a=i}if(a==0){a=1}var x=$("#ImageIcon");var B=$("#ImageDrag");var w=new Image();w.src=x.attr("src");var C=w.width;var z=w.height;if(C==0||z==0){if(BEGIN_HEIGHT>BEGIN_WIDTH){C=Math.round(Math.min(ICON_WIDTH_SIZE,ICON_HEIGHT_SIZE)*1.4);z=Math.round((BEGIN_HEIGHT/BEGIN_WIDTH)*C)}else{z=Math.round(Math.min(ICON_WIDTH_SIZE,ICON_HEIGHT_SIZE)*1.4);C=Math.round((BEGIN_WIDTH/BEGIN_HEIGHT)*z)}}w=null;var s=Math.round(a*C);var t=Math.round(a*z);var v=parseInt(x.css("left"));var D=parseInt(x.css("top"));v-=Math.round((s-h)/2);D-=Math.round((t-f)/2);c=v-LEFT_EDGE;q=D-TOP_EDGE;x.css({width:s+"px",height:t+"px",left:v+"px",top:D+"px"});B.css({width:s+"px",height:t+"px",left:c+"px",top:q+"px"});$("#txt_Zoom").val(a);$("#txt_left").val(0-c);$("#txt_top").val(0-q);$("#txt_width").val(s);$("#txt_height").val(t);h=s;f=t}});var r=function(y){var u=parseInt($(".child").css("left"));u+=y;if(u<0){u=0}if(u>200){u=200}a=Math.pow(i,(u/100-1));if(a<e){a=e}if(a>i){a=i}if(a==0){a=1}var x=$("#ImageIcon");var A=$("#ImageDrag");var w=new Image();w.src=x.attr("src");var B=w.width;var z=w.height;w=null;var s=Math.round(a*B);var t=Math.round(a*z);var v=parseInt(x.css("left"));var C=parseInt(x.css("top"));v-=Math.round((s-h)/2);C-=Math.round((t-f)/2);c=v-LEFT_EDGE;q=C-TOP_EDGE;$(".child").css("left",u+"px");x.css({width:s+"px",height:t+"px",left:v+"px",top:C+"px"});A.css({width:s+"px",height:t+"px",left:c+"px",top:q+"px"});$("#txt_Zoom").val(a);$("#txt_left").val(0-c);$("#txt_top").val(0-q);$("#txt_width").val(s);$("#txt_height").val(t);h=s;f=t}});