var CHAT_VERSON="V1.0";var mainhei=450;var mainColl=false;var WEB_ROOT="./";var MAINWIDTH=260;var MAIN_TOP_MARGIN=40;var COLL_WIDTH=MAINWIDTH/2-16;var ENG_ONE_CHAR="ABCDEFGHKLMNOPQRSTUVWXYZbghudopqwmn";var ENG_HALF_CHAR='acefijklrstvxyzIJ0123456789~!$%^&*()<>?:"{}\\/,.#*+';var ACCOUNT_ID=0;var SESSION_ID;var CHINESE_NAME="学者";var ICON_URL="";var PER_PAGE_WORDS=1500;var FRIEND_COUNT=0;var FRIEND_ONLINE_COUNT=0;var CHAT_WIN_ARR=new Array();var RECENT_COUNT=0;var RECENT_ONLINE_COUNT=0;var SHAKE_INTVL=20000;var SHAKE_TIMER=0;var START_LEFT=200;var START_TOP=20;var ONLINE_TYPE=1;var SEND_DLG_LEFT=START_LEFT;var SEND_DLG_TOP=START_TOP;var SEND_FILE_NAME;var SEND_FILE_ACCID;var FILE_SHARE_ID=0;var CHAT_LOGIN=false;var CHATONLINE=true;var EMOID=0;var EMO_WIN;var FSHARE_WIN;var FLIST_VIEW;var EMO_PANEL;var BUBBLE_WIN;var FILE_WIN;var TIPS_BOX;var TITLE_STEP=0;var TAB_TITLE=document.title;var LAST_SEND_TIME=0;var SEND_NAME="";var CHAT_SYS_TIME=new Date();var THIS_SHAKE_TIME=0;var LAST_SHAKE_TIME=CHAT_SYS_TIME.getTime();var CHAT_LOAD_TIME=0;var OTHER_WIN=false;var FRIEND_LOAD=1;var MAIN_LEFT_MARGIN=-1;var OFFMSG_ARR;var needSendOff=2;var needTeamSendOff=2;var lastUserOffMsg="";var lastTeamOffMsg="";var sendstr1="<table width=94% align=right><tr><th colspan=3><div align=center>";var sendstr2="</div></th></tr><tr><td width=300><div class=send><b class=b1></b><b class=b2></b><b class=b3></b><b class=b4></b><div class=boxcontent>";var sendstr3="</div><b class=b4b></b><b class=b3b></b><b class=b2b></b><b class=b1b></b></div></td><td><div style='margin:10px 0 0 0;border-width:6px;border-color:#ddd #dceeee #dceeee #ddd;border-style:solid;width:0;height:0;line-height:20px;'></div></td><td width=26><div class=icochat  align=right title=";var sendstr4="><img onError=\"this.src='images/chate.png'\" src=";var sendstr5=" width=25 height=25></div></td></tr></table>";var revstr1="<table width=94%><tr><th colspan=3><div align=center>";var revstr2="</div></th><td></td></tr><tr><td  width=26><div class=icochat title=";var revstr3="><img onError=\"this.src='images/chate.png'\" src=";var revstr4=" width=25 height=25></div></td><td><div style='margin:10px 0 0 0;border-width:6px;border-color:#90e546 #90e546 #dceeee #dceeee;border-style:solid;width:0;height:0;line-height:20px;'></div></td><td width=300><div class=receive><b class=b1></b><b class=b2></b><b class=b3></b><b class=b4></b><div class=boxcontent>";var revstr5="</div><b class=b4b></b><b class=b3b></b><b class=b2b></b><b class=b1b></b></div></td></tr></table>";var incomeMsg="";if(Ext.isIE7){revstr4=" width=25 height=25></div></td><td><div style='margin:10px 0 0 6px;border-width:6px;border-color:#90e546 #90e546 #dceeee #dceeee;border-style:solid;width:0;height:0;line-height:20px;'></div></td><td width=200><div class=receive><b class=b1></b><b class=b2></b><b class=b3></b><b class=b4></b><div class=boxcontentIE7>";sendstr2="</div></th></tr><tr><td width=300><div class=send><b class=b1></b><b class=b2></b><b class=b3></b><b class=b4></b><div class=boxcontentIE7>";revstr4=" width=25 height=25></div></td><td><div style='margin:10px 0 0 0;border-width:6px;border-color:#90e546 #90e546 #dceeee #dceeee;border-style:solid;width:0;height:0;line-height:20px;'></div></td><td width=300><div class=receive><b class=b1></b><b class=b2></b><b class=b3></b><b class=b4></b><div class=boxcontentIE7>"}window.onbeforeunload=function(){if(CHAT_LOGIN){logout();setTimeout("logout()",100)}};function submitClient(){ChatMng.update(CHAT_LOAD_TIME,ICON_URL)}window.onunload=onbeforeunload;function isIE11(){if(Ext.isIE){if(navigator.userAgent.toLowerCase().indexOf("rv:11")>-1){return true}}return false}function isEdge(){if(navigator.userAgent.toLowerCase().indexOf("edge")>-1){return true}return false}function isMacOS(){if(navigator.userAgent.toLowerCase().indexOf("mac")>-1){return true}return false}function insertAtCursor(d,a){if(Ext.isIE&&!isIE11()){d.getEl().focus();var e;e=document.selection.createRange();e.text=a;e.moveEnd("character",a.length);e.moveStart("character",a.length)}else{var c=d.getEl().dom.selectionStart;var b=d.getEl().dom.selectionEnd;d.getEl().dom.value=d.getEl().dom.value.substring(0,c)+a+d.getEl().dom.value.substring(b,d.getEl().dom.value.length);d.getEl().focus();d.getEl().dom.setSelectionRange(b+a.length,b+a.length)}}function logout(){if(CHAT_LOGIN){ChatMng.logout(ACCOUNT_ID,CHAT_LOAD_TIME);CHAT_LOGIN=false}}function soundinit(){soundManager=new SoundManager();soundManager.waitForWindowLoad=true;soundManager.debugMode=false;soundManager.url="./chatjs/swf";soundManager.beginDelayedInit();soundManager.onload=function(){soundManager.createSound({id:"msgSound",url:"./chatjs/mp3/msg.mp3"})}}function setdoctitle(){var a="-"+SEND_NAME+"- 来消息啦！...";TITLE_STEP++;if(TITLE_STEP>a.length){TITLE_STEP=0}document.title=a.substring(TITLE_STEP,a.length)+a.substring(0,TITLE_STEP)}var doctitletask={run:setdoctitle,interval:1000};function getQueryString(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)","i");var c=window.location.search.substr(1).match(b);if(c!=null){return unescape(c[2])}return null}function backtitle(){Ext.TaskMgr.stop(doctitletask);document.title=TAB_TITLE}function testchn(d){var c=/^[\u4E00-\u9FA5\uF900-\uFA2D]*$/;var b="";for(var a=0;a<d.length;a++){b=d.substring(a,a+1);if(c.test(b)||b==" "){return true}}return false}function closeemohiswin(){if(EMO_WIN){EMO_WIN.hide()}}function checkonline(b){var a=Ext.getCmp("mainwin").getFrdNode(b);if(a){return a.attributes.ol}else{return"f"}}function setonline(f,b,a){var e="tu"+f;if(Ext.getCmp(e)){var c=Ext.getCmp(e).title;if(a){c=c.replace("offline.jpg","online.jpg");c=c.replace("opacity:0.6;","")}else{c=c.replace("online.jpg","offline.jpg");c=c.replace("position:relative;>","position:relative;opacity:0.6;>")}Ext.getCmp(e).setTitle(c)}var d;if(a==1){d="o"}else{d="f"}if((a==1&&checkonline(f)=="f")||(a==0&&checkonline(f)=="o")){Ext.getCmp("mainwin").updateNode(f,d,b);Ext.getCmp("mainwin").checkmemExist(f)}}function init(){dwr.engine.setActiveReverseAjax(true)}function getstrbylen(f,b){tlength=b;wlength=0;var c="";var a=0;var e=0;f=f.replace(/\&nbsp;/g," ");if(f.length>tlength){for(var d=0;d<f.length;d++){c=f.substring(d,d+1);if(ENG_HALF_CHAR.indexOf(c)>-1){if(a==2){e++;a=0;wlength+=2}else{e++;a++;wlength++}}else{e++;wlength++}if(e>b-1){break}}f=f.substring(0,wlength)+"..."}return f}var expdlgtitle=function(d,a,c,g,h){var e;var f;var b;if(a=="o"){f="./chatjs/icons/online.jpg";e="./chatjs/icons/online-avatar.jpg";b="<div class=icobd style=width:70px;height:65px;position:relative;>"}else{f="./chatjs/icons/offline.jpg";e="./images/default.png";b="<div class=icobd style=width:70px;height:65px;position:relative;>"}if(c!=null&&c!=""&&c!="input"&&c!=WEB_ROOT){e=c}return"<table><tr><th rowspan=2>"+b+"<a href='./"+h+"' target='blank'/><img onError=\"this.src='http://www.scholat.com/chatjs/icons/online-avatar.jpg'\" src="+e+" width=54 height=54 title='访问 "+d+" 的学者主页'/><div style=width:8px;height:18px;position:absolute;top:48px;left:48px;><img src="+f+" width=8 height=8/></div></div></th><td><div style=font-size:16px;color:white;height:23px>"+d+"</div></td></tr><tr><td><div style='color:white;height:16px;width:185px;word-break:keep-all;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;' title="+g+">"+g+"</div></td></tr></table>"};function exit(){OTHER_WIN=true;Ext.TaskMgr.stop(checktask);if(CHAT_LOGIN==true){if(uploadIndex!=null){layer.close(uploadIndex)}tipsbox.msg("在线交流在其它窗口加载","本窗口交流模块自动关闭！",3)}CHAT_LOGIN=false;Ext.getCmp("mainwin").close()}function offexit(a){}function showsendwin(f,c){var e=Ext.getCmp("tu"+f);if(e){var a=Ext.getCmp("tu"+f+"mm").body;a.update(a.dom.innerHTML+c);var g=a.dom;g.scrollTop=g.scrollHeight-g.offsetHeight;Ext.getCmp("tu"+f).show();return}new SendMsgWin(f,c)}function getmaintitle(b,c){var a;var d="在线";if(b==1){a="online"}else{a="invisible";d="隐身"}return"<div style='color:white;height:20px;' title='当前状态："+d+"'><img src=./chatjs/icons/t"+a+".png width=16 height=16/>&nbsp;&nbsp;&nbsp;Live Chat ["+c+"]&nbsp;&nbsp;</div>"}function showfilesend(){return new UploadDialog({uploadUrl:"./uploadFiles.html;jsessionid="+SESSION_ID,filePostName:"myUpload",flashUrl:"./teamwork/js/swfupload.swf",fileSize:"100 MB",fileTypes:"*.*",fileTypesDescription:"所有文件",scope:this})}function showbbar(){Ext.getCmp("winbbar").show()}tipsbox=function(){if(TIPS_BOX){TIPS_BOX.remove()}function a(b,c){return["<div class=msg>","<div class=x-box-tl><div class=x-box-tr><div class=x-box-tc></div></div></div>","<div class=x-box-ml><div class=x-box-mr><div style=color:blue class=x-box-mc><h3>",b,"</h3>",c,"</div></div></div>","<div class=x-box-bl><div class=x-box-br><div class=x-box-bc></div></div></div>","</div>"].join("")}return{msg:function(h,d,e,g,k){if(!k){k="t-t"}if(!g){var f=Ext.getCmp("mainwin");if(f){g=Ext.getCmp("mainwin").getEl();k="tr-tl"}else{g=document;k="tr-tr"}}if(!e){e=1}if(!TIPS_BOX){TIPS_BOX=Ext.DomHelper.insertFirst(document.body,{id:"msg-div"},true)}var c=String.format.apply(String,Array.prototype.slice.call(arguments,1));var b=Ext.DomHelper.insertFirst(TIPS_BOX,{html:a(h,c)},true);b.slideIn("t").pause(e).ghost("b",{remove:true});TIPS_BOX.anchorTo(document,"tr-tr",[-277,40],true)}}}();offbubble=function(){function a(b,c){if(b!=null&&b!=undefined){return["<div id=",b,' class=msg style="position:fixed;top:38px;right:260px;margin-top:2px;padding:5px;font-size:12px;line-height:18px;background-color:#fff;border:1px #333 solid">',c,"</div>"].join("")}return['<div class=msg style="position:fixed;top:38px;right:260px;margin-top:2px;padding:5px;font-size:12px;line-height:18px;background-color:#fff;border:1px #333 solid">',c,"</div>"].join("")}return{msg:function(c,d){if(!BUBBLE_WIN){BUBBLE_WIN=Ext.DomHelper.insertFirst(document.body,{id:"bubble-div",style:"position:fixed"},true)}var e=document.getElementById(c);if(e!=null&&e!=undefined){return}var d=String.format.apply(String,Array.prototype.slice.call(arguments,1));var b=Ext.DomHelper.append(BUBBLE_WIN,{html:a(c,d)},true);b.slideIn("t").pause("300").ghost("b",{remove:true});BUBBLE_WIN.anchorTo(Ext.getCmp("mainwin").getEl(),"tr-tl",[-10,0])}}}();function bubbleclick(c,h,k,l,o,f){ChatMng.deloff(ACCOUNT_ID,c,o,f);if(incomeMsg.indexOf(f)>0){return}incomeMsg=incomeMsg+f+",";if(incomeMsg.length>70){incomeMsg=incomeMsg.substring(incomeMsg.length-45,incomeMsg.length)}var g=parseInt(k);var e=OFFMSG_ARR[g];e=expmsgclass(prcsemo(e));if(BUBBLE_WIN!=""&&BUBBLE_WIN!=undefined&&BUBBLE_WIN!=null){if(o=="user"){var a=document.getElementById(c+"_u2");if(a!=undefined&&a!=null){a.parentNode.removeChild(a)}}else{var a=document.getElementById(c+"_t1");if(a!=undefined&&a!=null){a.parentNode.removeChild(a)}}}if(o=="user"){if(needSendOff>0||lastUserOffMsg!=e){showsendwin(c,e);needSendOff=0}else{openNewWindow(c,h,"","")}lastUserOffMsg=e}else{if(needTeamSendOff>0||lastTeamOffMsg!=e){BUBBLE_WIN.remove();BUBBLE_WIN="";if(Ext.getCmp("tt"+c)){var p=Ext.getCmp("tt"+c+"mm").body;p.update(p.dom.innerHTML+e);var n=p.dom;n.scrollTop=n.scrollHeight-n.offsetHeight;Ext.getCmp("tt"+c).showDlg();needTeamSendOff=0}else{new SendTeamMsgWin(c,h,e,"nodel")}}lastTeamOffMsg=e}setTimeout("showfile()",2400);if($("#mainwin").hasClass("x-panel-collapsed")){$(".x-window-header-text").click();$(".x-window").css("top","40px");$(".x-window").css("left","auto");$(".x-window").css("right","260px")}}function showoff(){var a=true;var b=new Ext.data.JsonStore({id:"offstore",autoLoad:true,proxy:new Ext.data.HttpProxy({url:"./SeekOffActionForChat.html?acc_id="+ACCOUNT_ID}),fields:["name","msg","accid","type","time"]});b.load({callback:function(d,p,l){if(l){if(d.length>0&&BUBBLE_WIN!=""&&BUBBLE_WIN!=undefined&&BUBBLE_WIN!=null){BUBBLE_WIN.remove();BUBBLE_WIN=""}if(d.length>0){soundManager.play("msgSound")}else{return}var o;var h;var c="";OFFMSG_ARR=new Array();for(var f=0;f<d.length;f++){o=b.getAt(f);var k=o.get("type");var e;if(k=="team"){e="tt"+o.get("accid")}else{e="tu"+o.get("accid")}var g=Ext.getCmp(e);var n=o.get("msg");OFFMSG_ARR[f]=n;if(g){bubbleclick(o.get("accid"),o.get("name"),f,d.length,k,o.get("time"))}else{h='"'+o.get("accid")+'","'+o.get("name")+'","'+f+'","'+d.length+'","'+k+'","'+o.get("time")+'"';if(d.length>1){c=c+"来自<a onclick='bubbleclick("+h.replace(/'/g,"‘")+")' style='color:blue;cursor:pointer'>&nbsp"+getstrbylen(o.get("name"),9)+"&nbsp</a>的新消息<br>"}else{offbubble.msg(o.get("accid")+"_u2","来自<a onclick='bubbleclick("+h.replace(/'/g,"‘")+")' style='color:blue;cursor:pointer'>&nbsp"+getstrbylen(o.get("name"),9)+"&nbsp</a>的新消息")}}}if(d.length>1){offbubble.msg(null,"<div id='allmsg'>您有"+d.length+"条未读消息</div><div id='hideoffmsg' style='display:none;' name='close'>"+c+"</div><div id='showalloffmsg' style='color:#F15191;cursor:pointer' onclick='showalloffmsg()'>展开查看</div>")}if(d.length>=1){a=false}}if(a){needSendOff=0;needTeamSendOff=0}else{if(needSendOff==-1){needSendOff=2}if(needTeamSendOff==-1){needTeamSendOff=2}}b.remove()}});if(a&&needSendOff!=0){needSendOff=-1}if(a&&needTeamSendOff!=0){needTeamSendOff=-1}}function showalloffmsg(){var a=$("#hideoffmsg").attr("name");if(a=="open"){$("#showalloffmsg").html("展开查看");$("#hideoffmsg").attr("name","close");$("#hideoffmsg").hide("blind",{},100)}if(a=="close"){$("#showalloffmsg").html("收起列表");$("#hideoffmsg").attr("name","open");$("#hideoffmsg").show("blind",{},100)}}function fileclick(e,d,b,a,c){if(c=="reject"){if(BUBBLE_WIN!=""&&BUBBLE_WIN!=undefined&&BUBBLE_WIN!=null){BUBBLE_WIN.remove();BUBBLE_WIN=""}ChatMng.delfile(ACCOUNT_ID,e,d,b)}if(a>1){setTimeout("showfile()",1000)}else{setTimeout("showoff()",1000)}}function showfile(){if(BUBBLE_WIN!=""&&BUBBLE_WIN!=undefined&&BUBBLE_WIN!=null){BUBBLE_WIN.remove();BUBBLE_WIN=""}var a=new Ext.data.JsonStore({id:"filestore",autoLoad:false,proxy:new Ext.data.HttpProxy({url:"./SeekFileActionForChat.html?acc_id="+ACCOUNT_ID}),fields:["accid","name","file","time","code"]});a.load({callback:function(f,b,g){if(g){if(f.length>0){soundManager.play("msgSound")}var e;for(var c=0;c<f.length;c++){e=a.getAt(c);var d='"'+e.get("accid")+'","'+e.get("time")+'","'+e.get("file")+'","'+f.length+'","reject"';offbubble.msg(e.get("accid")+"_file","<a onclick='fileclick("+d+")'  style='color:blue;'><img src= './images/action_delete.png' title='不再提示'></a>"+getstrbylen(e.get("name"),6)+"给您发送文件<br><a  href='./downloadChatAtt.html?fileid="+e.get("time")+"&accid="+ACCOUNT_ID+"&code="+e.get("code")+"'  target='_blank' style='color:blue'><img src='./images/download.png' title='下载文件'></a>"+getstrbylen(e.get("file"),14))}showoff()}a.remove()}})}function expmsgclass(a){a=a.replace(/\[revstr1]/g,revstr1);a=a.replace(/\[revstr2]/g,revstr2);a=a.replace(/\[revstr3]/g,revstr3);a=a.replace(/\[revstr4]/g,revstr4);a=a.replace(/\[revstr5]/g,revstr5);return a}function revmsg(a,g,k,c,n){if(k!=ACCOUNT_ID){return}var f="tu"+a;var o=Ext.getCmp(f);c=prcsemo(c);SEND_NAME=g;if(TAB_TITLE==document.title){Ext.TaskMgr.start.defer(100,this,[doctitletask])}var e=Ext.getCmp("sb_"+f);if(e&&current_winid!=""){if(o){var s=o.getPicUrl();var h="f";if(o.title.indexOf("offline")>-1){setonline(a,g,1);h="o"}if(s==""){s="http://www.scholat.com//images/default.png"}var q=Ext.getCmp("tu"+a+"mm").body;var p=q.dom;c=q.dom.innerHTML+revstr1+revstr2+g+revstr3+s+revstr4+c+revstr5;q.update(c);p.scrollTop=p.scrollHeight-p.offsetHeight;ChatMng.remseal(n)}if(current_winid!=f){setSliderbarTitle(a,true)}}else{if(!e||current_winid==""||checkwin(f)==false){var r=getradnum();var l="<div id='"+r+"'>"+g+'来消息了！<div onclick="openNewWindow('+a+",'"+g+"','"+c+"','"+n+"')\" style='color:#F15191;cursor:pointer'>查看</div></div>";offbubble.msg(a+"_u1",l);if(needSendOff!=2){needSendOff=0}var t={from_acc_id:a,from_chnname:g,msg:c,radnum:r,seal:n};newMsg_arr.push(t);var e=Ext.getCmp("sb_"+f);if(e){setSliderbarTitle(a,true)}}}soundManager.play("msgSound")}function getradnum(){var b="";for(var a=0;a<6;a++){b+=Math.floor(Math.random()*10)}return b}function openNewWindow(f,c,g,e){var h=document.getElementById(f+"_u1");if(h!=null&&h!=undefined){h.parentNode.removeChild(h)}var b="tu"+f;var d=Ext.getCmp(b);if(d){d.showDlg()}else{var a="http://www.scholat.com//images/default.png";CHAT_WIN_ARR[CHAT_WIN_ARR.length]=b;g=revstr1+revstr2+c+revstr3+a+revstr4+g+revstr5;SendMsgWin(f,g);ChatMng.remseal(e)}if($("#mainwin").hasClass("x-panel-collapsed")){$(".x-window-header-text").click();$(".x-window").css("top","40px");$(".x-window").css("left","auto");$(".x-window").css("right","260px")}}function openNewTeamWindow(a,b){var c=document.getElementById(a+"_t1");if(c!=null&&c!=undefined){c.parentNode.removeChild(c)}new SendTeamMsgWin(a,b,"");if($("#mainwin").hasClass("x-panel-collapsed")){$(".x-window-header-text").click();$(".x-window").css("top","40px");$(".x-window").css("left","auto");$(".x-window").css("right","260px")}}function showOffMsg(a,f,c,p,h){var e="tu"+a;var k=Ext.getCmp(e);var g="#"+p;$(g).parent().remove();if(k){var o=k.getPicUrl();if(k.title.indexOf("offline")>-1){setonline(a,f,1)}var n=Ext.getCmp("tu"+a+"mm").body;var l=n.dom;if(o==""){o="http://www.scholat.com//images/default.png"}c=n.dom.innerHTML+revstr1+revstr2+f+revstr3+o+revstr4+c+revstr5;n.update(c);l.scrollTop=l.scrollHeight-l.offsetHeight;k.show();ChatMng.remseal(h)}}function teammsg(h,f,p,o,a){var e="tt"+p;var k=Ext.getCmp(e);a=expmsgclass(prcsemo(a));SEND_NAME="[ "+o+" : "+f+" ]";if(TAB_TITLE==document.title){Ext.TaskMgr.start.defer(100,this,[doctitletask])}var c=Ext.getCmp("sb_"+e);if(c&&current_winid!=""){if(k){var n=Ext.getCmp("tt"+p+"mm").body;var l=n.dom;a=l.innerHTML+a;n.update(a);l.scrollTop=l.scrollHeight-l.offsetHeight;if(current_winid!=e){setSliderbarTeamTitle(p,true)}ChatMng.remseal(h)}}else{if(current_winid!=e||checkwin(e)==false){CHAT_WIN_ARR[CHAT_WIN_ARR.length]=e;var q=getradnum();var g="<div id='"+q+"'>团队："+o+'有新消息！<div onclick="openNewTeamWindow('+p+",'"+o+"')\" style='color:#F15191;cursor:pointer'>查看</div></div>";offbubble.msg(p+"_t1",g);var r={from_chnname:f,team_id:p,team_name:o,msg:a,seal:h};newTeamMsg_arr.push(r);var c=Ext.getCmp("sb_"+e);if(c){setSliderbarTeamTitle(p,true)}}}soundManager.play("msgSound")}function sysmsg(a,c,b){if(a=="学者网即时通知"){b="20"}tipsbox.msg(a,c,b)}function setstate(b){ONLINE_TYPE=b;var a=Ext.getCmp("winbbar");if(a==null){return}if(b==1){a.setText("在线");a.setIconClass("online")}else{a.setText("隐身");a.setIconClass("invisible")}Ext.getCmp("mainwin").setTitle(getmaintitle(ONLINE_TYPE,FRIEND_ONLINE_COUNT))}function setstatemenu(b){var a=Ext.getCmp("winbbar");if(a==null){return}if(b==1){a.setText("在线");a.setIconClass("online")}else{a.setText("隐身");a.setIconClass("invisible")}}function showsendmsg(b,e){var a=Ext.getCmp(e);var c=Ext.getCmp(b);var g=htmlrep(a.getValue());if(g.substr(0,4)=="<br>"){g=g.substr(4,g.length)}var f=c.body.dom;g=sendstr1+sendstr2+prcsemo(g)+sendstr3+CHINESE_NAME+sendstr4+ICON_URL+sendstr5;g=f.innerHTML+g;c.body.update(g);a.setValue("");f.scrollTop=f.scrollHeight-f.offsetHeight}var checktask={run:logincheck,interval:SHAKE_INTVL};function logincheck(){SHAKE_TIMER++;if((SHAKE_TIMER>270&&SHAKE_TIMER!=null)||CHAT_LOAD_TIME=="0"||CHAT_LOAD_TIME==0){if(CHAT_LOGIN==true){Ext.TaskMgr.stop(checktask);CHAT_LOGIN=false;ChatMng.logout(ACCOUNT_ID,CHAT_LOAD_TIME);tipsbox.msg("长时间没有操作","<br>聊天模块自动下线，<br><br>刷新页面可重新加载！",120);Ext.getCmp("mainwin").close();return}}if(CHATONLINE){ChatMng.check(CHAT_LOAD_TIME,{callback:callbackcheck,timeout:12000,errorHandler:function(a){offexit(a)}})}if(FRIEND_COUNT==0&&FRIEND_LOAD<6&&FRIEND_LOAD%2==0){Ext.getCmp("mainwin").updateList();FRIEND_LOAD=FRIEND_LOAD+1}else{if(FRIEND_LOAD<5){FRIEND_LOAD=FRIEND_LOAD+1}}}function callbackcheck(a){if(a=="0"){CHATONLINE=false;exit()}}function checkwin(b){for(var a=0;a<CHAT_WIN_ARR.length;a++){if(b==CHAT_WIN_ARR[a]){return true}}return false}function delwin(b){for(var a=0;a<CHAT_WIN_ARR.length;a++){if(b==CHAT_WIN_ARR[a]){CHAT_WIN_ARR.splice(a,1)}}}function htmlrep(a){m=a.replace(/\</g,"&lt;");m=m.replace(/\r\n/g,"<br>");m=m.replace(/\r/g,"<br>");m=m.replace(/\n/g,"<br>");return m}String.prototype.Trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")};function prcsemo(c){var f="<img src=./emo/";var b=".gif title=";var a=">";c=c.replace(/\[爱你]/g,f+"aini"+b+"爱你"+a);c=c.replace(/\[傲慢]/g,f+"aoman"+b+"傲慢"+a);c=c.replace(/\[白眼]/g,f+"baiyan"+b+"白眼"+a);c=c.replace(/\[拜拜]/g,f+"baibai"+b+"拜拜"+a);c=c.replace(/\[抱抱]/g,f+"baobao"+b+"抱抱"+a);c=c.replace(/\[抱拳]/g,f+"baoquan"+b+"抱拳"+a);c=c.replace(/\[匕首]/g,f+"bishou"+b+"匕首"+a);c=c.replace(/\[鄙视]/g,f+"bishi"+b+"鄙视"+a);c=c.replace(/\[闭嘴]/g,f+"bizhui"+b+"闭嘴"+a);c=c.replace(/\[不是]/g,f+"bushi"+b+"不是"+a);c=c.replace(/\[擦汗]/g,f+"cahan"+b+"擦汗"+a);c=c.replace(/\[菜刀]/g,f+"caidao"+b+"菜刀"+a);c=c.replace(/\[差劲]/g,f+"chajin"+b+"差劲"+a);c=c.replace(/\[臭虫]/g,f+"choucong"+b+"臭虫"+a);c=c.replace(/\[出糗]/g,f+"chuqiu"+b+"出糗"+a);c=c.replace(/\[呲牙]/g,f+"ciya"+b+"呲牙"+a);c=c.replace(/\[大便]/g,f+"dabian"+b+"大便"+a);c=c.replace(/\[大兵]/g,f+"dabin"+b+"大兵"+a);c=c.replace(/\[大哭]/g,f+"daku"+b+"大哭"+a);c=c.replace(/\[大骂]/g,f+"dama"+b+"大骂"+a);c=c.replace(/\[蛋糕]/g,f+"dangao"+b+"蛋糕"+a);c=c.replace(/\[得意]/g,f+"deyi"+b+"得意"+a);c=c.replace(/\[凋谢]/g,f+"diaoxie"+b+"凋谢"+a);c=c.replace(/\[发呆]/g,f+"fadai"+b+"发呆"+a);c=c.replace(/\[发怒]/g,f+"fanu"+b+"发怒"+a);c=c.replace(/\[飞吻]/g,f+"feiwen"+b+"飞吻"+a);c=c.replace(/\[奋斗]/g,f+"fengdou"+b+"奋斗"+a);c=c.replace(/\[尴尬]/g,f+"ganga"+b+"尴尬"+a);c=c.replace(/\[勾引]/g,f+"gouyin"+b+"勾引"+a);c=c.replace(/\[鼓掌]/g,f+"guzhang"+b+"鼓掌"+a);c=c.replace(/\[哈欠]/g,f+"haqian"+b+"哈欠"+a);c=c.replace(/\[害羞]/g,f+"haixiu"+b+"害羞"+a);c=c.replace(/\[憨笑]/g,f+"hanxiao"+b+"憨笑"+a);c=c.replace(/\[好的]/g,f+"haode"+b+"好的"+a);c=c.replace(/\[黑线]/g,f+"heixian"+b+"黑线"+a);c=c.replace(/\[红心]/g,f+"hongxin"+b+"红心"+a);c=c.replace(/\[坏笑]/g,f+"huaixiao"+b+"坏笑"+a);c=c.replace(/\[击打]/g,f+"jida"+b+"击打"+a);c=c.replace(/\[饥饿]/g,f+"jie"+b+"饥饿"+a);c=c.replace(/\[惊恐]/g,f+"jinkong"+b+"惊恐"+a);c=c.replace(/\[惊讶]/g,f+"jinya"+b+"惊讶"+a);c=c.replace(/\[咖啡]/g,f+"kafei"+b+"咖啡"+a);c=c.replace(/\[可爱]/g,f+"keai"+b+"可爱"+a);c=c.replace(/\[可怜]/g,f+"kelian"+b+"可怜"+a);c=c.replace(/\[抠鼻]/g,f+"koubi"+b+"抠鼻"+a);c=c.replace(/\[骷髅]/g,f+"kulou"+b+"骷髅"+a);c=c.replace(/\[酷酷]/g,f+"kuku"+b+"酷酷"+a);c=c.replace(/\[困困]/g,f+"kunkun"+b+"困困"+a);c=c.replace(/\[篮球]/g,f+"lanqiu"+b+"篮球"+a);c=c.replace(/\[冷汗]/g,f+"lenghan"+b+"冷汗"+a);c=c.replace(/\[礼物]/g,f+"liwu"+b+"礼物"+a);c=c.replace(/\[流汗]/g,f+"liuhan"+b+"流汗"+a);c=c.replace(/\[流泪]/g,f+"liulei"+b+"流泪"+a);c=c.replace(/\[玫瑰]/g,f+"meigui"+b+"玫瑰"+a);c=c.replace(/\[米饭]/g,f+"mifan"+b+"米饭"+a);c=c.replace(/\[拇指]/g,f+"muzhi"+b+"拇指"+a);c=c.replace(/\[难过]/g,f+"nanguo"+b+"难过"+a);c=c.replace(/\[呕吐]/g,f+"outu"+b+"呕吐"+a);c=c.replace(/\[撇嘴]/g,f+"piezhui"+b+"撇嘴"+a);c=c.replace(/\[亲亲]/g,f+"qinqin"+b+"亲亲"+a);c=c.replace(/\[拳头]/g,f+"quantou"+b+"拳头"+a);c=c.replace(/\[弱爆]/g,f+"ruobao"+b+"弱爆"+a);c=c.replace(/\[色色]/g,f+"sese"+b+"色色"+a);c=c.replace(/\[闪电]/g,f+"shandian"+b+"闪电"+a);c=c.replace(/\[胜利]/g,f+"shengli"+b+"胜利"+a);c=c.replace(/\[衰衰]/g,f+"suaisuai"+b+"衰衰"+a);c=c.replace(/\[睡觉]/g,f+"shuijiao"+b+"睡觉"+a);c=c.replace(/\[太阳]/g,f+"taiyang"+b+"太阳"+a);c=c.replace(/\[调皮]/g,f+"tiaopi"+b+"调皮"+a);c=c.replace(/\[偷笑]/g,f+"touxiao"+b+"偷笑"+a);c=c.replace(/\[熬夜]/g,f+"aoye"+b+"熬夜"+a);c=c.replace(/\[委屈]/g,f+"weiqu"+b+"委屈"+a);c=c.replace(/\[握手]/g,f+"woshou"+b+"握手"+a);c=c.replace(/\[西瓜]/g,f+"xigua"+b+"西瓜"+a);c=c.replace(/\[想哭]/g,f+"xiangku"+b+"想哭"+a);c=c.replace(/\[心碎]/g,f+"xinsui"+b+"心碎"+a);c=c.replace(/\[嘘嘘]/g,f+"xuxu"+b+"嘘嘘"+a);c=c.replace(/\[雪糕]/g,f+"xuegao"+b+"雪糕"+a);c=c.replace(/\[疑问]/g,f+"yiwen"+b+"疑问"+a);c=c.replace(/\[阴险]/g,f+"yinxian"+b+"阴险"+a);c=c.replace(/\[右哼]/g,f+"youheng"+b+"右哼"+a);c=c.replace(/\[月亮]/g,f+"yueliang"+b+"月亮"+a);c=c.replace(/\[晕晕]/g,f+"yunyun"+b+"晕晕"+a);c=c.replace(/\[炸弹]/g,f+"zhadan"+b+"炸弹"+a);c=c.replace(/\[猪头]/g,f+"zhutou"+b+"猪头"+a);c=c.replace(/\[抓狂]/g,f+"zhuakuang"+b+"抓狂"+a);c=c.replace(/\[足球]/g,f+"zuqiu"+b+"足球"+a);c=c.replace(/\[左哼]/g,f+"zuoheng"+b+"左哼"+a);c=c.replace(/\[微笑]/g,f+"weixiao"+b+"微笑"+a);return c}function randTime(){var b=new Array("A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9");var a=b.length;var c="";for(i=0;i<2;i++){j=Math.floor(Math.random()*a);c+=b[j]}return c}function clke(b){var a=Ext.getCmp(EMOID+"em");insertAtCursor(a,"["+b+"]");EMO_WIN.hide();a.focus()}function Eeo(c,a){return"<img src=./emo/"+a+".gif title="+c+" onclick='clke(\""+c+"\")'>"}var EmoSum=Eeo("微笑","weixiao")+Eeo("傲慢","aoman")+Eeo("拜拜","baibai")+Eeo("白眼","baiyan")+Eeo("鄙视","bishi")+Eeo("闭嘴","bizhui")+Eeo("擦汗","cahan")+Eeo("出糗","chuqiu")+Eeo("呲牙","ciya")+Eeo("大兵","dabin")+Eeo("大哭","daku")+Eeo("大骂","dama")+Eeo("得意","deyi")+Eeo("发呆","fadai")+Eeo("飞吻","feiwen")+Eeo("奋斗","fengdou")+Eeo("鼓掌","guzhang")+Eeo("哈欠","haqian")+Eeo("害羞","haixiu")+Eeo("憨笑","hanxiao")+Eeo("黑线","heixian")+Eeo("坏笑","huaixiao")+Eeo("击打","jida")+Eeo("饥饿","jie")+Eeo("惊讶","jinya")+Eeo("可爱","keai")+Eeo("可怜","kelian")+Eeo("抠鼻","koubi")+Eeo("酷酷","kuku")+Eeo("困困","kunkun")+Eeo("冷汗","lenghan")+Eeo("流汗","liuhan")+Eeo("流泪","liulei")+Eeo("鄙视","bishi")+Eeo("难过","nanguo")+Eeo("呕吐","outu")+Eeo("撇嘴","piezhui")+Eeo("亲亲","qinqin")+Eeo("抓狂","zhuakuang")+Eeo("色色","sese")+Eeo("睡觉","shuijiao")+Eeo("调皮","tiaopi")+Eeo("偷笑","touxiao")+Eeo("熬夜","aoye")+Eeo("委屈","weiqu")+Eeo("想哭","xiangku")+Eeo("嘘嘘","xuxu")+Eeo("疑问","yiwen")+Eeo("阴险","yinxian")+Eeo("右哼","youheng")+Eeo("左哼","zuoheng")+Eeo("晕晕","yunyun")+Eeo("惊恐","jinkong")+Eeo("发怒","fanu")+Eeo("尴尬","ganga")+Eeo("衰衰","suaisuai")+Eeo("炸弹","zhadan")+Eeo("猪头","zhutou")+Eeo("足球","zuqiu")+Eeo("篮球","lanqiu")+Eeo("勾引","gouyin")+Eeo("爱你","aini")+Eeo("抱拳","baoquan")+Eeo("不是","bushi")+Eeo("好的","haode")+Eeo("拇指","muzhi")+Eeo("弱爆","ruobao")+Eeo("差劲","chajin")+Eeo("拳头","quantou")+Eeo("胜利","shengli")+Eeo("握手","woshou")+Eeo("西瓜","xigua")+Eeo("心碎","xinsui")+Eeo("红心","hongxin")+Eeo("月亮","yueliang")+Eeo("太阳","taiyang")+Eeo("闪电","shandian")+Eeo("雪糕","xuegao")+Eeo("咖啡","kafei")+Eeo("骷髅","kulou")+Eeo("抱抱","baobao")+Eeo("礼物","liwu")+Eeo("米饭","mifan")+Eeo("匕首","bishou");EMO_PANEL=new Ext.Panel({id:"emopnl",layout:"fit",frame:true,html:"<div id='bbcode_emotions'>"+EmoSum+"</div>",bodyStyle:"padding:2px 12px 4px 12px;background-color:#fff"});var wgMgr=new Ext.WindowGroup();wgMgr.zseed=10000;EMO_WIN=new Ext.Window({id:"emowin",width:330,height:224,title:"选择表情",style:"position:fixed",resizable:false,draggable:false,shadow:false,closable:false,iconCls:"main",closeAction:"hide",manager:wgMgr,items:[EMO_PANEL]});EMO_WIN.on("deactivate",function(){this.setZIndex(99999)});window.onload=init;