(function(undefined){var _global;function extend(def,opt,override){for(var k in opt){if(opt.hasOwnProperty(k)&&(!def.hasOwnProperty(k)||override)){def[k]=opt[k]}}return def}function formartDate(y,m,d,symbol){symbol=symbol||"-";m=(m.toString())[1]?m:"0"+m;d=(d.toString())[1]?d:"0"+d;return y+symbol+m+symbol+d}function formartDate1(y,m,d,symbol){m=(m.toString())[1]?m:"0"+m;d=(d.toString())[1]?d:"0"+d;return y+"年"+m+"月"}function Schedule(opt){var def={},opt=extend(def,opt,true),curDate=opt.date?new Date(opt.date):new Date(),year=curDate.getFullYear(),month=curDate.getMonth(),day=curDate.getDate(),currentYear=curDate.getFullYear(),currentMonth=curDate.getMonth(),currentDay=curDate.getDate(),selectedDate="",el=document.querySelector(opt.el)||document.querySelector("body"),_this=this;var bindEvent=function(){el.addEventListener("click",function(e){switch(e.target.id){case"nextMonth":_this.nextMonthFun();break;case"nextYear":_this.nextYearFun();break;case"prevMonth":_this.prevMonthFun();break;case"prevYear":_this.prevYearFun();break;default:break}if(e.target.className.indexOf("currentDate")>-1){selectedDate=e.target.title;day=e.target.innerHTML;render()}},false)};var init=function(){var scheduleHd='<div class="schedule-hd"><div><span id="prevMonth"><</span></div><div class="today">'+formartDate(year,month+1,day,"-")+'</div><div><span  id="nextMonth">></span></div></div>';var scheduleWeek='<ul class="week-ul ul-box"><li>日</li><li>一</li><li>二</li><li>三</li><li>四</li><li>五</li><li>六</li></ul>';var scheduleBd='<ul class="schedule-bd ul-box" ></ul>';el.innerHTML=scheduleHd+scheduleWeek+scheduleBd;bindEvent();render()};var render=function(){var fullDay=new Date(year,month+1,0).getDate(),startWeek=new Date(year,month,1).getDay(),total=(fullDay+startWeek)%7==0?(fullDay+startWeek):fullDay+startWeek+(7-(fullDay+startWeek)%7),lastMonthDay=new Date(year,month,0).getDate(),eleTemp=[];for(var i=0;i<total;i++){if(i<startWeek){eleTemp.push('<li class="other-month"><span class="dayStyle">'+(lastMonthDay-startWeek+1+i)+"</span></li>")}else{if(i<(startWeek+fullDay)){var nowDate=formartDate(year,month+1,(i+1-startWeek),"-");var addClass="";selectedDate==nowDate&&(addClass="selected-style");formartDate(currentYear,currentMonth+1,currentDay,"-")==nowDate&&(addClass="today-flag");eleTemp.push('<li class="current-month" ><span title='+nowDate+' class="currentDate dayStyle '+addClass+'">'+(i+1-startWeek)+'</span><div class="today-remind"></div></li>')}else{eleTemp.push('<li class="other-month"><span class="dayStyle">'+(i+1-(startWeek+fullDay))+"</span></li>")}}}el.querySelector(".schedule-bd").innerHTML=eleTemp.join("");el.querySelector(".today").innerHTML=formartDate1(year,month+1,day,"-");var fristDate=new Date(year,month,1);var fristDay=fristDate.getDay();if(fristDay==0){var newstart=new Date(year,month,-5)}else{var newstart=new Date(year,month,2-fristDay)}var newend=new Date(year,month,30);DWREngine.setAsync(false);DWREngine.setErrorHandler(function(){return});DWREngine.setWarningHandler(function(){return});CalendarAjaxService.getCoursesByPeriod(newstart,newend,function(data){var jsonDate=JSON.parse(data);for(var i=0;i<jsonDate.length;i++){var e=jsonDate[i];showCourseEventItem(e)}});var DateStart=newstart.getDate();if(DateStart<10){DateStart="0"+DateStart}var DateEnd=newend.getDate();if(DateEnd<10){DateEnd="0"+DateEnd}$.post("ScholarSeekMyCalendar.html",{startDate:newstart.getFullYear()+"-"+(newstart.getMonth()+1)+"-"+DateStart+" 00:00:00",endDate:newend.getFullYear()+"-"+(newend.getMonth()+1)+"-"+DateEnd+" 23:59:59"},function(data){for(var j=0;j<data.length;j++){showCalendarEventItem(data[j])}},"json");var todayStartDate=new Date(year,month,day);var todayEndDate=new Date(year,month,day,23,59,59);showOneDayCal(todayStartDate,todayEndDate)};function formatWeek(day){switch(day){case 0:return"星期日";break;case 1:return"星期一";break;case 2:return"星期二";break;case 3:return"星期三";break;case 4:return"星期四";break;case 5:return"星期五";break;case 6:return"星期六";break}}var todayDate=new Date();var todayText=""+todayDate.getFullYear()+"."+(todayDate.getMonth()+1)+"."+todayDate.getDate()+"    "+formatWeek(todayDate.getDay())+"";$("#cal_today_title").text(todayText);var course_remind="";CalendarAjaxService.getRemindCalendars(function(data){if(data.length>0){course_remind="<img src='./calendar/images/remind.gif' style='width:40px;height:40px;margin-bottom:-10px;margin-top:-10px;'/>";$("#cal_today_course_remind").html(course_remind)}else{course_remind="<img src='./calendar/images/remind.png' style='width:40px;height:40px;margin-bottom:-10px;margin-top:-10px;'/>";$("#cal_today_course_remind").html(course_remind)}});var showCourseEventItem=function(cal){var calDay=cal.startCourseTime.substring(8,10);var calMonth=cal.startCourseTime.substring(5,7);var calYear=cal.startCourseTime.substring(0,4);var tempDate=new Date(calYear,calMonth-1,calDay);var showDay=calDay;var count=0;var showIndex=0;var week=cal.weekEnd-cal.weekStart+1;var weekIndex=cal.weekStart;if(tempDate.getMonth()<month){tempDate.setDate(tempDate.getDate()+7);week--}if(week<=0){return}showDay=tempDate.getDate();$(".current-month").each(function(index,element){var compareDay=$(this).text();if(compareDay==showDay&&count==0){$(this).addClass("hasCourse");count++;showIndex=index+7}else{if(showIndex==index&&count>0&&count<week){$(this).addClass("hasCourse");count++;showIndex=index+7}}})};var showCalendarEventItem=function(cal){var calStartDay=cal.start.substring(8,10);var calEndDay=cal.end.substring(8,10);var calStartYear=cal.start.substring(0,4);var calEndYear=cal.end.substring(0,4);var calEndMonth=cal.end.substring(5,7);var calStartMonth=cal.start.substring(5,7);var calStartDate=new Date(calStartYear,calStartMonth-1,calStartDay);var calEndDate=new Date(calEndYear,calEndMonth-1,calEndDay);var showMonth=month+1;if(showMonth<10){showMonth="0"+showMonth}if(cal.end.substring(0,10)>=(year+"-"+showMonth+"-01")){if(cal.start.substring(0,10)<(year+"-"+showMonth+"-01")){calStartDay="1"}if(cal.end.substring(0,10)>(year+"-"+showMonth+"-"+$(".current-month:last").text())){calEndDay=$(".current-month:last").text()}}else{return}if(parseInt(calStartDay)<10){calStartDay="0"+calStartDay}if(parseInt(calEndDay)<10){calEndDay="0"+calEndDay}var startDate=new Date(year+"/"+month+"/"+calStartDay);var endDate=new Date(year+"/"+month+"/"+calEndDay);var difDay=endDate.getDate()-startDate.getDate()+1;var count=0;$(".current-month").each(function(index,element){var compareDay=$(this).text();if(compareDay==startDate.getDate()){if($(this).hasClass("hasCourse")){$(this).removeClass("hasCourse");$(this).addClass("hasCourseCal");$(this).find(".today-remind").html("<span class='showpoint-left'></span><span class='showpoint-right'></span>")}else{if(!$(this).hasClass("hasCourseCal")){$(this).addClass("hasCalendar")}}count++}else{if(count>0&&count<difDay){if($(this).hasClass("hasCourse")){$(this).removeClass("hasCourse");$(this).addClass("hasCourseCal");$(this).find(".today-remind").html("<span class='showpoint-left'></span><span class='showpoint-right'></span>")}else{if(!$(this).hasClass("hasCourseCal")){$(this).addClass("hasCalendar")}}count++}}})};var showOneDayCal=function(startDate,endDate){$(".month-calendar-daydetail").empty();CalendarAjaxService.getOneDayCourseAndCalendar(startDate,endDate,function(data){var jsonDate=JSON.parse(data);if(jsonDate.length>0){for(var i=0;i<jsonDate.length;i++){if(jsonDate[i].type==1){showOneDayCourse(jsonDate[i])}else{showOneDayCalendar(jsonDate[i])}}}else{$(".month-calendar-daydetail").append("<div style='text-align: center;'>暂时还没有日程</div>")}})};var showOneDayCourse=function(data){var startTime=data.classStartTime;if(startTime==""){startTime=data.classstart+"-"+data.classend+"节"}var inserCourseItem="<div class='courseItem'><div class='showtime'>"+startTime+"</div><div class='courseItem-content'>"+data.courseName+"</div></div>";$(".month-calendar-daydetail").append(inserCourseItem)};var showOneDayCalendar=function(data){var start_Time=data.start.substring(11,16);var inserCalendarItem="<div class='calendarItem' ><div class='showtime'>"+start_Time+"</div><div class='calendarItem-content'> <span>"+data.content;if(data.location!=""&&data.location!=" undefined"){inserCalendarItem+="</span>&nbsp;&nbsp;<span class='am-icon-map-marker icon calendarLocation'>&nbsp;"+data.location+"</span>"}inserCalendarItem+="</div></div>";$(".month-calendar-daydetail").append(inserCalendarItem)};this.nextMonthFun=function(){if(month+1>11){year+=1;month=0}else{month+=1}render()},this.nextYearFun=function(){year+=1;render()},this.prevMonthFun=function(){if(month-1<0){year-=1;month=11}else{month-=1}render()},this.prevYearFun=function(){year-=1;render()};init()}_global=(function(){return this||(0,eval)("this")}());if(typeof module!=="undefined"&&module.exports){module.exports=Schedule}else{if(typeof define==="function"&&define.amd){define(function(){return Schedule})}else{!("Schedule" in _global)&&(_global.Schedule=Schedule)}}}());